<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Настройки игры</title>
    <link rel="shortcut icon" href="favicon.ico">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    

</head>
<bodys>
    <form>
        <label for="nickname">Отключать уведомления, когда шпионов:</label>
        <input min="0" max="20" type="number" id="neutralization_message_id" value="5"/>
        <small id="neutralization_messageHelp">Уведомления о нейтрализации будут отключены, когда останется 5 шпионов.</small><br>
        
        <br>
        <label>Свидетели:</label><br>
        <select id="witness_id" class="form-select">
            <option value="all">Все окружающие</option>
            <option value="gamers">Только игроки</option>
        </select>
        <small>Укажите, кто может стать свидетелем нейтрализации.</small><br>
        
        <br>
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="gamers_list_id" checked>
            <label>Список игроков на старте.</label>
        </div>
        <small id="gamers_listHelp">В начале игры появится список всех участников.</small><br>
        
        <br>
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="spy_confirm_id" checked>
            <label>Шпион сам проверяет выполнение правил.</label>
        </div>
        <small id="spy_confirmHelp">Подтверждать нейтрализацию будет шпион.</small><br>

        <br>
        <label>Опциональные правила</label>
        <textarea id="extra_preferences_id" rows="3"></textarea>
        <small>Укажите здесь правила, которые мы не предусмотрели.</small><br>
        
        <br>
        <center>
            <input id="submitBtn" type="submit" value="Сохранить">
        </center>
    </form>
    <script src="https://telegram.org/js/telegram-web-app.js">
    </script>
    <script>
        let tg = window.Telegram.WebApp;
        let submitBtn = document.getElementById("submitBtn");
        tg.expand();
        
        let neutralization_message_field = document.getElementById("neutralization_message_id");
        neutralization_message_field.addEventListener("change",()=>{
            if (neutralization_message_field.value == 0){
                document.getElementById("neutralization_messageHelp").textContent = "Уведомления о нейтрализации будут приходить всегда.";
            }else{
                let spies_text = " шпионов."
                if (neutralization_message_field.value == 1) {
                    spies_text = " шпион."
                } else if (neutralization_message_field.value == 2 || neutralization_message_field.value == 3 || neutralization_message_field.value == 4){
                    spies_text = " шпиона."
                }
                document.getElementById("neutralization_messageHelp").textContent = "Уведомления о нейтрализации будут отключены, когда останется " + neutralization_message_field.value + spies_text;
            }
        });

        let spy_confirm_field = document.getElementById("spy_confirm_id");
        spy_confirm_field.addEventListener("change",()=>{
            let spy_confirm_text = "агент."
            if (spy_confirm_field.checked){
                spy_confirm_text = "шпион."
            }
            document.getElementById("spy_confirmHelp").textContent = "Подтверждать нейтрализацию будет " + spy_confirm_text;
            
        });

        let gamers_list_field = document.getElementById("gamers_list_id");
        gamers_list_field.addEventListener("change",()=>{
            if (gamers_list_field.checked){
                document.getElementById("gamers_listHelp").textContent = "В начале игры появится список всех участников.";
            }else{
                document.getElementById("gamers_listHelp").textContent = "Игроки не получат точный список участников.";
            }
        });

        submitBtn.addEventListener("click", () =>{
            document.getElementById("error").innerText = "";
            document.getElementById("error").style.visibility = "hidden";
            let _name = document.getElementById("first_name_id").value;
            let _surname = document.getElementById("surname_id").value;
            let _nickname = document.getElementById("nickname_id").value;

            if (_name.length == 0){
                document.getElementById("error").innerText = "Имя слишком короткое.";
                document.getElementById("error").style.visibility = "visible";
                return;
            }
            if (_surname.length == 0){
                document.getElementById("error").innerText = "Фамилия слишком короткая.";
                document.getElementById("error").style.visibility = "visible";
                return;
            }
            if (_nickname.length == 0){
                document.getElementById("error").innerText = "Никнейм слишком короткий.";
                document.getElementById("error").style.visibility = "visible";
                return;
            }
            
            let data = {
                type: "questionnaire",
                name: _name,
                surname: _surname,
                nickname: _nickname,
                continent: document.getElementById("continent_id").value,
                drink: document.getElementById("drink_id").value,
                transport: document.getElementById("transport_id").value,
                smell: document.getElementById("smell_id").value,
                pet: document.getElementById("pet_id").value,
                employment: document.getElementById("employment_id").value
            }
            tg.sendData(JSON.stringify(data));

            tg.close()

            return;
        });

    </script>
</body>
</html>