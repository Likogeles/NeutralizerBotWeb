<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Анкета</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<bodys>
    <form>
        <label for="first_name">Имя (больше 5 символов)</label><br>
        <input type="text" id="first_name_id" name="first_name" required><br>
        <small id="first_nameHelp">По нему вас узнают другие игроки.</small><br><br>
        
        <label for="surname">Фамилия (больше 5 символов)</label><br>
        <input type="text" id="surname_id" name="surname" required><br>
        <small id="surnameHelp">По ней вас узнают другие игроки.</small><br><br>
        
        <label for="nickname">Никнейм (больше 5 символов)</label><br>
        <input type="text" id="nickname_id" name="nickname" required><br>
        <small id="nicknameHelp">Анонимный никнейм, для отображения в таблице лидеров.</small><br>
        <br>

        <label>Что вы больше любите?</label><br>
        <select id="drink_id" class="form-select">
            <option value="tea">Чай</option>
            <option value="coffee">Кофе</option>
            <option value="milk">Молоко</option>
        </select><br>

        <div id="error" class="alert alert-danger" role="alert" visibility="hidden"></div>

        <center>
            <input id="submitBtn" type="submit" value="Отправить">
        </center>
    </form>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        let tg = window.Telegram.WebApp;
        let submitBtn = document.getElementById("submitBtn");
        tg.expand();

        submitBtn.addEventListener("click", () =>{
            document.getElementById("error").innerText = "";
            document.getElementById("error").style.visibility = "hidden";
            let _name = document.getElementById("first_name_id").value;
            let _surname = document.getElementById("surname_id").value;
            let _nickname = document.getElementById("nickname_id").value;

            if (_name.length < 5){
                document.getElementById("error").innerText = "Имя слишком короткое.";
                document.getElementById("error").style.visibility = "visible";
                return;
            }
            if (_surname.length < 5){
                document.getElementById("error").innerText = "Фамилия слишком короткая.";
                document.getElementById("error").style.visibility = "visible";
                return;
            }
            if (_nickname.length < 5){
                document.getElementById("error").innerText = "Никнейм слишком короткий.";
                document.getElementById("error").style.visibility = "visible";
                return;
            }
            
            let data = {
                type: "questionnaire",
                name: _name,
                surname: _surname,
                nickname: _nickname,
                drink: document.getElementById("drink_id").value
            }
            tg.sendData(JSON.stringify(data));

            tg.close()

            return;
        });

    </script>
</body>
</html>